From bfe0730b9a01be986fe90a97d728f9cb5a65f397 Mon Sep 17 00:00:00 2001
From: almiheenko <al.miheenko@gmail.com>
Date: Fri, 15 Dec 2017 16:45:54 +0300
Subject: [PATCH 1/2] Use gnuplot from PATH is exists

---
 quast_libs/ca_utils/misc.py | 17 +++++++++++------
 1 file changed, 11 insertions(+), 6 deletions(-)

diff --git a/quast_libs/ca_utils/misc.py b/quast_libs/ca_utils/misc.py
index b1bb279..63de509 100644
--- a/quast_libs/ca_utils/misc.py
+++ b/quast_libs/ca_utils/misc.py
@@ -22,7 +22,8 @@ except ImportError:
    from quast_libs.site_packages.ordered_dict import OrderedDict
 
 from quast_libs import qconfig, qutils
-from quast_libs.qutils import compile_tool, val_to_str, check_prev_compilation_failed, write_failed_compilation_flag
+from quast_libs.qutils import compile_tool, val_to_str, check_prev_compilation_failed, write_failed_compilation_flag, \
+    get_path_to_program
 
 contig_aligner = None
 contig_aligner_dirpath = join(qconfig.LIBS_LOCATION, 'MUMmer')
@@ -104,18 +105,21 @@ def compile_aligner(logger, only_clean=False):
 
 
 def gnuplot_exec_fpath():
+    system_gnuplot_fpath = get_path_to_program('gnuplot')
+    if system_gnuplot_fpath:
+        return system_gnuplot_fpath, True
     tool_dirpath = join(qconfig.LIBS_LOCATION, 'gnuplot')
     tool_src_dirpath = join(tool_dirpath, 'src')
     tool_exec_fpath = join(tool_src_dirpath, 'gnuplot')
-    return tool_exec_fpath
+    return tool_exec_fpath, False
 
 
 def compile_gnuplot(logger, only_clean=False):
     tool_dirpath = join(qconfig.LIBS_LOCATION, 'gnuplot')
-    tool_exec_fpath = gnuplot_exec_fpath()
+    tool_exec_fpath, is_system = gnuplot_exec_fpath()
 
     if only_clean:
-        if isfile(tool_exec_fpath):
+        if not is_system and isfile(tool_exec_fpath):
             os.remove(tool_exec_fpath)
         return True
 
@@ -155,9 +159,10 @@ def draw_mummer_plot(logger, nucmer_fpath, delta_fpath, index, log_out_f, log_er
     if return_code == 0:
         plot_script_fpath = nucmer_fpath + '.gp'
         temp_plot_fpath = nucmer_fpath + '.html'
-        if isfile(plot_script_fpath) and isfile(gnuplot_exec_fpath()):
+        gnuplot_fpath, _ = gnuplot_exec_fpath()
+        if isfile(plot_script_fpath) and isfile(gnuplot_fpath):
             qutils.call_subprocess(
-                [gnuplot_exec_fpath(), plot_script_fpath],
+                [gnuplot_fpath, plot_script_fpath],
                 stdout=open('/dev/null', 'w'), stderr=log_err_f,
                 indent='  ' + qutils.index_to_str(index))
             if isfile(temp_plot_fpath):
-- 
2.7.2


From 360b7ee67952fc28a1427b5bbaff3960824ed166 Mon Sep 17 00:00:00 2001
From: Alexey Gurevich <alexeigurevich@gmail.com>
Date: Fri, 15 Dec 2017 13:29:03 +0300
Subject: [PATCH 2/2] setup.py: fixed missing gnuplot find_package_files

---
 setup.py | 1 +
 1 file changed, 1 insertion(+)

diff --git a/setup.py b/setup.py
index 3c3949d..7e36954 100755
--- a/setup.py
+++ b/setup.py
@@ -229,6 +229,7 @@ The tool accepts multiple assemblies, thus is suitable for comparison.''',
             find_package_files('genemark-es/' + qconfig.platform_name) +
             find_package_files('genemark-es/lib') +
             find_package_files('glimmer') +
+            find_package_files('gnuplot') +
             find_package_files('gage') +
             bwa_files +
             ['bedtools/bin/*'] +
-- 
2.7.2

