From c2bfac81d906ce83caff1cf7d6ed60b202754953 Mon Sep 17 00:00:00 2001
From: almiheenko <al.miheenko@gmail.com>
Date: Tue, 19 Dec 2017 13:08:06 +0300
Subject: [PATCH] Print debug info

---
 quast_libs/ca_utils/align_contigs.py | 16 +++++++++++++---
 quast_libs/options_parser.py         |  1 +
 2 files changed, 14 insertions(+), 3 deletions(-)

diff --git a/quast_libs/ca_utils/align_contigs.py b/quast_libs/ca_utils/align_contigs.py
index 05c484f4..304772a6 100644
--- a/quast_libs/ca_utils/align_contigs.py
+++ b/quast_libs/ca_utils/align_contigs.py
@@ -86,7 +86,17 @@ def run_nucmer(prefix, ref_fpath, contigs_fpath, log_out_fpath, log_err_fpath, i
             nucmer_cmdline += ['--emempath', installed_emem_fpath]
 
     nucmer_cmdline += [ref_fpath, contigs_fpath]
-    return_code = qutils.call_subprocess(nucmer_cmdline, stdout=open(log_out_fpath, 'a'), stderr=open(log_err_fpath, 'a'),
+    try:
+        perl_path = open(bin_fpath('nucmer')).readline()
+        if perl_path:
+            perl_path = perl_path.replace('#!', '').strip()
+            if os.path.exists(perl_path):
+                sys.stdout.write('\nPerl exists: ' + perl_path + '\n')
+            else:
+                sys.stdout.write('\nPerl does not exist: ' + perl_path + '\n')
+    except:
+        pass
+    return_code = qutils.call_subprocess(nucmer_cmdline, stdout=sys.stdout, stderr=sys.stderr,
                                          indent='  ' + qutils.index_to_str(index), env=env)
 
     return return_code
@@ -103,8 +113,8 @@ def get_nucmer_aux_out_fpaths(nucmer_fpath):
 
 def align_contigs(nucmer_fpath, ref_fpath, contigs_fpath, old_contigs_fpath, index,
                   parallel_by_chr, threads, log_out_fpath, log_err_fpath):
-    log_out_f = open(log_out_fpath, 'w')
-    log_err_f = open(log_err_fpath, 'w')
+    log_out_f = sys.stdout
+    log_err_f = sys.stderr
 
     nucmer_successful_check_fpath = nucmer_fpath + '.sf'
     delta_fpath = nucmer_fpath + '.delta'
diff --git a/quast_libs/options_parser.py b/quast_libs/options_parser.py
index 0861dba6..70ff0e64 100644
--- a/quast_libs/options_parser.py
+++ b/quast_libs/options_parser.py
@@ -534,6 +534,7 @@ def parse_options(logger, quast_args, is_metaquast=False):
         wrong_test_option(logger, msg, is_metaquast)
 
     if qconfig.test or qconfig.test_no_ref or qconfig.test_sv:
+        qconfig.max_threads = 1
         qconfig.output_dirpath = abspath(qconfig.test_output_dirname)
         check_dirpath(qconfig.output_dirpath, 'You are trying to run QUAST from ' + str(os.path.dirname(qconfig.output_dirpath)) + '.\n' +
                       'Please, rerun QUAST from a different directory.')
-- 
2.14.3 (Apple Git-98)

